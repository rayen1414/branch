<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Branch | Obsidian & Gold</title>
    <link rel="stylesheet" href="branch.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <!-- Shell skin: CSS-only overrides for the outer interface. Never touches server JS. -->
    <style id="branch-shell-skin"></style>
    <style>
    /* ‚îÄ‚îÄ Search Dropdown ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    .search-container { position: relative; }

    .search-dropdown {
        position: absolute;
        top: calc(100% + 8px);
        left: 0; right: 0;
        background: #1a1a20;
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 12px;
        overflow: hidden;
        z-index: 9999;
        box-shadow: 0 8px 32px rgba(0,0,0,0.5);
        max-height: 340px;
        overflow-y: auto;
    }
    .search-dropdown.hidden { display: none; }

    .sd-section {
        padding: 8px 14px 4px;
        font-size: 10px;
        letter-spacing: .08em;
        text-transform: uppercase;
        color: rgba(255,255,255,0.3);
        font-weight: 700;
    }
    .sd-user {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 9px 14px;
        cursor: pointer;
        transition: background .15s;
    }
    .sd-user:hover { background: rgba(255,255,255,0.05); }
    .sd-av {
        width: 34px; height: 34px;
        border-radius: 10px;
        display: flex; align-items: center; justify-content: center;
        font-weight: 800; font-size: 14px;
        flex-shrink: 0;
    }
    .sd-info { flex: 1; min-width: 0; }
    .sd-name { font-size: 13px; font-weight: 600; color: #fff; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .sd-handle { font-size: 11px; color: rgba(255,255,255,0.4); }
    .sd-empty {
        padding: 20px 14px;
        font-size: 13px;
        color: rgba(255,255,255,0.3);
        text-align: center;
    }
    .sd-loading {
        padding: 16px 14px;
        font-size: 12px;
        color: rgba(255,255,255,0.35);
        text-align: center;
    }
    .sd-user-btn {
        font-size: 11px;
        padding: 4px 10px;
        border-radius: 6px;
        border: 1px solid rgba(255,255,255,0.15);
        background: transparent;
        color: rgba(255,255,255,0.6);
        cursor: pointer;
        transition: all .15s;
    }
    .sd-user-btn:hover { background: rgba(255,255,255,0.08); color: #fff; }
    </style>
</head>
<body>

    <div class="logo" onclick="toggleinterface()" title="Toggle Interface" data-icon="logo"></div>

    <header class="top-bar">
        <div class="search-container" id="search-container">
            <input type="text" id="search-input" placeholder="Explore branches... or @username"
                   oninput="handleSearchInput(this.value)"
                   onkeydown="handleSearchKey(event)"
                   autocomplete="off">
            <button class="search-btn" data-icon="search" onclick="triggerSearch()"></button>
            <div id="search-dropdown" class="search-dropdown hidden"></div>
        </div>
        <div class="top-actions">
            <div class="action-item" onclick="toggleMenu('notif-dropdown')" data-icon="bell">
                <div class="notif-badge">3</div>
                <div id="notif-dropdown" class="dropdown-menu">
                    <div class="menu-header">Recent Activity</div>
                    <div class="menu-item">
                        <span style="display:block;font-size:11px;color:var(--accent);opacity:0.7;">DESIGN</span>
                        New branch in <b>UI/UX Assets</b>
                    </div>
                    <div class="menu-item">
                        <span style="display:block;font-size:11px;color:var(--accent);opacity:0.7;">SYSTEM</span>
                        Update v2.4 successfully applied
                    </div>
                    <div class="menu-item"><b>Alex</b> mentioned you in a log</div>
                </div>
            </div>
            <div class="action-item" onclick="toggleMenu('settings-dropdown')" data-icon="settings">
                <div id="settings-dropdown" class="dropdown-menu">
                    <div class="menu-header">Preferences</div>
                    <div class="menu-item" onclick="openShellCustomizer(); toggleMenu('settings-dropdown')" style="cursor:pointer;">
                        <span style="opacity:0.7;margin-right:6px;">üñ•</span>Customize Shell
                    </div>
                    <div class="menu-item">Account Settings</div>
                    <div class="menu-item" onclick="doLogout()" style="color:#ff4d4d;border-top:1px solid rgba(255,255,255,0.05);margin-top:5px;cursor:pointer;">Logout</div>
                </div>
            </div>
            <div class="divider"></div>
            <div class="user-profile" onclick="openFriendPanel()" style="cursor:pointer;" title="Friends & Profile">
                <div class="user-info">
                    <span class="username">...</span>
                    <span class="status-text">In a Branch</span>
                </div>
                <div class="avatar-frame">
                    <div class="avatar-status"></div>
                    <div class="avatar-content" id="top-avatar" style="background:#c8ff00;color:#000;font-weight:800;font-size:22px;">?</div>
                </div>
            </div>
        </div>
    </header>

    <nav class="sidebar" id="main-sidebar">
        <div class="hide-arrow" onclick="togglebar()">&#x2039;</div>
        <div class="draggable-zone" id="draggable-zone">
            <div class="sidebar-item active" draggable="true"
                 data-id="home"
                 data-server-name="Dashboard" data-owner="true" data-default="true"
                 oncontextmenu="openContextMenu(event,this)">
                <div class="active-pill"></div>
                <div class="icon-box" data-icon="home"></div>
            </div>
            <div class="sidebar-item" draggable="true"
                 data-id="explore"
                 data-server-name="Discovery" data-owner="true" data-default="true"
                 oncontextmenu="openContextMenu(event,this)">
                <div class="active-pill"></div>
                <div class="icon-box" data-icon="explore"></div>
            </div>
            <div class="sidebar-item" draggable="true"
                 data-id="media"
                 data-server-name="Media Library" data-owner="true" data-default="true"
                 oncontextmenu="openContextMenu(event,this)">
                <div class="active-pill"></div>
                <div class="icon-box" data-icon="media"></div>
            </div>
        </div>
        <div class="separator"></div>
        <div class="sidebar-item plus-btn" onclick="openCreateModal()">
            <div class="icon-box" data-icon="plus"></div>
        </div>
    </nav>

    <!-- FIX: main-container closes friend panel on click -->
    <main class="main-container" id="main-container">
        <iframe id="server-iframe" class="server-iframe" sandbox="allow-scripts allow-same-origin"></iframe>
    </main>

    <!-- RIGHT-CLICK CONTEXT MENU -->
    <div id="server-context-menu" class="context-menu">
        <div class="ctx-group ctx-default-only">
            <div class="context-menu-item context-edit" onclick="openCustomizer()">
                <span class="ctx-icon">üé®</span>
                <div><div>Customize</div><div class="ctx-sub">Colors ¬∑ Font ¬∑ Background</div></div>
            </div>
        </div>
        <div class="ctx-group ctx-admin-only">
            <div class="context-menu-item context-edit" onclick="openEditor()">
                <span class="ctx-icon">‚ú¶</span>
                <div><div>Open Editor</div><div class="ctx-sub">Full HTML ¬∑ CSS ¬∑ JS</div></div>
            </div>
            <div class="context-menu-item" onclick="closeContextMenu()">
                <span class="ctx-icon">‚öô</span> Server Settings
            </div>
        </div>
        <div class="ctx-group ctx-member-only">
            <div class="context-menu-item context-edit" onclick="openEditor()">
                <span class="ctx-icon">üé®</span>
                <div><div>My Skin</div><div class="ctx-sub">CSS only ¬∑ Visible only to you</div></div>
            </div>
        </div>
        <div class="context-menu-sep"></div>
        <div class="context-menu-item" onclick="closeContextMenu()">
            <span class="ctx-icon">üìå</span> Pin to Top
        </div>
        <div class="context-menu-item context-danger" onclick="closeContextMenu()">
            <span class="ctx-icon">üö™</span> Leave Server
        </div>
    </div>

    <!-- EDITOR OVERLAY -->
    <div id="editor-overlay" class="editor-overlay hidden">
        <div class="ed-topbar">
            <div class="ed-brand">‚¨° Branch</div>
            <div class="ed-role-badge ed-role-admin" id="ed-badge-admin">ADMIN EDITOR</div>
            <div class="ed-role-badge ed-role-member" id="ed-badge-member">CUSTOMIZE</div>
            <div class="ed-server-name" id="ed-server-name">Server</div>
            <div class="ed-spacer"></div>
            <div class="ed-tab-group" id="ed-mode-tabs">
                <button class="ed-tab active" onclick="edSetMode(event,'split')">Split</button>
                <button class="ed-tab" onclick="edSetMode(event,'code')">Code</button>
                <button class="ed-tab" onclick="edSetMode(event,'preview')">Preview</button>
            </div>
            <div class="ed-tab-group" id="ed-skin-tabs" style="display:none;">
                <button class="ed-tab active" id="ed-skin-code-btn" onclick="edSkinSetPanel('code',this)">‚ú¶ CSS</button>
            </div>
            <button class="ed-btn ed-btn-ghost" onclick="edRefresh()" id="ed-refresh-btn">‚Üª Refresh</button>
            <button class="ed-btn ed-btn-accent" id="ed-publish-btn" onclick="edPublish()">‚ñ≤ Publish</button>
            <button class="ed-btn ed-btn-save"   id="ed-save-btn"    onclick="edPublish()">üíæ Save Skin</button>
            <button class="ed-btn ed-btn-exit" onclick="closeEditor()">‚úï Exit</button>
        </div>

        <div class="ed-workspace">
            <div class="ed-visual-panel" id="ed-visual-panel" style="display:none;"></div>
            <div class="ed-visual-panel" id="ed-shell-panel" style="display:none;"></div>

            <div class="ed-editor-panel" id="ed-editor-panel">
                <div class="ed-file-tabs" id="ed-file-tabs">
                    <div class="ed-file-tab active ed-admin-tab" data-file="html" onclick="edSwitchFile('html',this)"><span class="ed-dot"></span>index.html</div>
                    <div class="ed-file-tab ed-admin-tab" data-file="css" onclick="edSwitchFile('css',this)"><span class="ed-dot"></span>styles.css</div>
                    <div class="ed-file-tab ed-admin-tab" data-file="js" onclick="edSwitchFile('js',this)"><span class="ed-dot"></span>app.js</div>
                    <div class="ed-file-tab ed-member-tab" data-file="skin" onclick="edSwitchFile('skin',this)"><span class="ed-dot"></span>my-skin.css</div>
                </div>
                <div id="ed-monaco" style="flex:1;"></div>
            </div>
            <div class="ed-resizer" id="ed-resizer"></div>

            <div class="ed-preview-panel" id="ed-preview-panel">
                <div class="ed-preview-bar">
                    <div class="ed-preview-dots">
                        <span style="background:#ff5f57"></span>
                        <span style="background:#febc2e"></span>
                        <span style="background:#28c840"></span>
                    </div>
                    <div class="ed-url-bar">üîí branch.app/s/<span id="ed-url-slug">server</span></div>
                    <button class="ed-device-btn active" onclick="edSetDevice(event,'desktop')" title="Desktop">üñ•</button>
                    <button class="ed-device-btn" onclick="edSetDevice(event,'mobile')" title="Mobile">üì±</button>
                </div>
                <div class="ed-local-notice" id="ed-local-notice">
                    ‚úé Editing this server's CSS directly. Click "Save to Server" to apply permanently.
                </div>
                <div class="ed-frame-wrap" id="ed-frame-wrap">
                    <iframe id="ed-iframe" sandbox="allow-scripts"></iframe>
                </div>
            </div>
        </div>

        <div class="ed-statusbar">
            <span id="ed-status-pos">Ln 1, Col 1</span>
            <span id="ed-status-lang">CSS</span>
            <span style="margin-left:auto;" id="ed-status-chars">0 chars</span>
        </div>
        <div class="ed-toast" id="ed-toast">‚úì Published to everyone</div>
        <div class="ed-toast" id="ed-toast-save" style="background:#60a5fa;color:#000;">üíæ Saved to server CSS</div>
    </div>

    <!-- CREATE SERVER MODAL -->
    <div id="create-modal-backdrop" class="modal-backdrop hidden" onclick="handleBackdropClick(event)">
        <div class="create-modal">

            <div class="modal-step active" id="step-1">
                <div class="modal-header">
                    <div class="modal-title">Create a Server</div>
                    <div class="modal-sub">Your server, your rules. Build anything.</div>
                </div>
                <div class="server-type-grid">
                    <div class="server-type-card selected" onclick="selectType(this,'scratch')">
                        <div class="type-icon">‚ú¶</div>
                        <div class="type-name">From Scratch</div>
                        <div class="type-desc">Blank canvas. You code everything.</div>
                    </div>
                    <div class="server-type-card" onclick="selectType(this,'template')">
                        <div class="type-icon">‚¨°</div>
                        <div class="type-name">From Template</div>
                        <div class="type-desc">Start with a pre-built design.</div>
                    </div>
                    <div class="server-type-card" onclick="selectType(this,'community')">
                        <div class="type-icon">‚óà</div>
                        <div class="type-name">Community</div>
                        <div class="type-desc">Default Branch UI, no coding needed.</div>
                    </div>
                </div>
                <div class="modal-actions">
                    <button class="modal-btn modal-btn-ghost" onclick="closeCreateModal()">Cancel</button>
                    <button class="modal-btn modal-btn-accent" onclick="goToStep(2)">Next &rarr;</button>
                </div>
            </div>

            <div class="modal-step" id="step-2">
                <button class="modal-back" onclick="goToStep(1)">&larr; Back</button>
                <div class="modal-header">
                    <div class="modal-title">Name Your Server</div>
                    <div class="modal-sub">Set a name, pick a photo or icon, and choose your accent color.</div>
                </div>

                <input type="file" id="photo-file-input" accept="image/*" onchange="handlePhotoUpload(event)">

                <div class="step2-grid">
                    <div class="step2-left">
                        <div class="modal-field">
                            <label class="field-label">Server Photo</label>
                            <div class="photo-upload-zone" id="photo-upload-zone" onclick="triggerPhotoUpload()">
                                <div class="photo-upload-icon">üì∑</div>
                                <div class="photo-upload-label">Click to upload<br><span>JPG, PNG, GIF, WEBP</span></div>
                                <button class="photo-upload-remove" onclick="removePhoto(event)" title="Remove photo">‚úï</button>
                            </div>
                        </div>
                        <div class="modal-field">
                            <label class="field-label">Or pick an icon</label>
                            <div style="display:flex;align-items:center;gap:16px;">
                                <div class="icon-preview" id="icon-preview">‚ú¶</div>
                                <div class="icon-options">
                                    <span onclick="pickIcon(this,'‚ú¶')" class="selected">‚ú¶</span>
                                    <span onclick="pickIcon(this,'‚¨°')">‚¨°</span>
                                    <span onclick="pickIcon(this,'‚óà')">‚óà</span>
                                    <span onclick="pickIcon(this,'‚äï')">‚äï</span>
                                    <span onclick="pickIcon(this,'‚¨í')">‚¨í</span>
                                    <span onclick="pickIcon(this,'‚ñ≥')">‚ñ≥</span>
                                    <span onclick="pickIcon(this,'‚òΩ')">‚òΩ</span>
                                    <span onclick="pickIcon(this,'‚òÖ')">‚òÖ</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="step2-right">
                        <div class="modal-field">
                            <label class="field-label">Server Name</label>
                            <input class="field-input" id="server-name-input" type="text"
                                   placeholder="e.g. Neon District" maxlength="32"
                                   oninput="updateSlugPreview()">
                            <div class="field-hint">branch.app/s/<span id="slug-preview">neon-district</span></div>
                        </div>
                        <div class="modal-field">
                            <label class="field-label">Description <span style="opacity:0.4;font-weight:400;text-transform:none;letter-spacing:0;">(optional)</span></label>
                            <input class="field-input" id="server-desc-input" type="text"
                                   placeholder="What is this server about?" maxlength="80">
                        </div>
                        <div class="modal-field">
                            <label class="field-label">Accent Color</label>
                            <div class="color-row" style="flex-wrap:wrap;">
                                <div class="color-swatch selected" style="background:#c8ff00" onclick="pickColor(this,'#c8ff00')"></div>
                                <div class="color-swatch" style="background:#ff00ff" onclick="pickColor(this,'#ff00ff')"></div>
                                <div class="color-swatch" style="background:#00ffff" onclick="pickColor(this,'#00ffff')"></div>
                                <div class="color-swatch" style="background:#ff6b35" onclick="pickColor(this,'#ff6b35')"></div>
                                <div class="color-swatch" style="background:#a78bfa" onclick="pickColor(this,'#a78bfa')"></div>
                                <div class="color-swatch" style="background:#34d399" onclick="pickColor(this,'#34d399')"></div>
                                <div class="color-swatch" style="background:#f9a8d4" onclick="pickColor(this,'#f9a8d4')"></div>
                                <input type="color" class="color-custom" id="color-custom"
                                       value="#c8ff00" oninput="pickColorCustom(this.value)">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="modal-actions">
                    <button class="modal-btn modal-btn-ghost" onclick="closeCreateModal()">Cancel</button>
                    <button class="modal-btn modal-btn-accent" onclick="createServer()">Create Server</button>
                </div>
            </div>

            <div class="modal-step" id="step-3">
                <div class="modal-success">
                    <div class="success-icon" id="success-icon">‚ú¶</div>
                    <div class="modal-title">Server Created!</div>
                    <div class="modal-sub" id="success-name">Your server is ready.</div>
                    <div class="success-hint">It's been added to your sidebar.<br>Right-click it to open the editor.</div>
                </div>
                <div class="modal-actions" style="justify-content:center;">
                    <button class="modal-btn modal-btn-ghost" onclick="closeCreateModal()">Maybe Later</button>
                    <button class="modal-btn modal-btn-accent" onclick="openNewServerEditor()">Open Editor &rarr;</button>
                </div>
            </div>

        </div>
    </div>

    <!-- SHELL CUSTOMIZER -->
    <div id="shc-backdrop" class="shc-backdrop" onclick="closeShellCustomizer()"></div>
    <div id="shc-panel" class="shc-panel">
        <div class="shc-header">
            <div class="shc-header-text">
                <div class="shc-title">üñ• Shell Customizer</div>
                <div class="shc-sub">Reshapes the outer Branch interface live ‚Äî server code never touched</div>
            </div>
            <button class="shc-close" onclick="closeShellCustomizer()">‚úï</button>
        </div>

        <div class="shc-body">
            <div class="shc-section">COLORS</div>
            <div class="shc-grid2">
                <div class="shc-field">
                    <div class="shc-flabel">Accent</div>
                    <div class="shc-cpair">
                        <input type="color" id="shc-accent" value="#d2d2d2" oninput="shcColor('accent',this.value)">
                        <input type="text"  id="shc-accent-hex" class="shc-hex" value="#d2d2d2" maxlength="7" oninput="shcHex('accent',this.value)">
                    </div>
                </div>
                <div class="shc-field">
                    <div class="shc-flabel">Page Background</div>
                    <div class="shc-cpair">
                        <input type="color" id="shc-bg" value="#08080a" oninput="shcColor('bg',this.value)">
                        <input type="text"  id="shc-bg-hex" class="shc-hex" value="#08080a" maxlength="7" oninput="shcHex('bg',this.value)">
                    </div>
                </div>
                <div class="shc-field">
                    <div class="shc-flabel">Topbar</div>
                    <div class="shc-cpair">
                        <input type="color" id="shc-topbar-bg" value="#121217" oninput="shcColor('topbar-bg',this.value)">
                        <input type="text"  id="shc-topbar-bg-hex" class="shc-hex" value="#121217" maxlength="7" oninput="shcHex('topbar-bg',this.value)">
                    </div>
                </div>
                <div class="shc-field">
                    <div class="shc-flabel">Sidebar</div>
                    <div class="shc-cpair">
                        <input type="color" id="shc-sidebar-bg" value="#121217" oninput="shcColor('sidebar-bg',this.value)">
                        <input type="text"  id="shc-sidebar-bg-hex" class="shc-hex" value="#121217" maxlength="7" oninput="shcHex('sidebar-bg',this.value)">
                    </div>
                </div>
                <div class="shc-field">
                    <div class="shc-flabel">Logo Background</div>
                    <div class="shc-cpair">
                        <input type="color" id="shc-logo-bg" value="#d2d2d2" oninput="shcColor('logo-bg',this.value)">
                        <input type="text"  id="shc-logo-bg-hex" class="shc-hex" value="#d2d2d2" maxlength="7" oninput="shcHex('logo-bg',this.value)">
                    </div>
                </div>
                <div class="shc-field">
                    <div class="shc-flabel">Logo Icon</div>
                    <div class="shc-cpair">
                        <input type="color" id="shc-logo-icon" value="#08080a" oninput="shcColor('logo-icon',this.value)">
                        <input type="text"  id="shc-logo-icon-hex" class="shc-hex" value="#08080a" maxlength="7" oninput="shcHex('logo-icon',this.value)">
                    </div>
                </div>
                <div class="shc-field">
                    <div class="shc-flabel">Text</div>
                    <div class="shc-cpair">
                        <input type="color" id="shc-text" value="#ffffff" oninput="shcColor('text',this.value)">
                        <input type="text"  id="shc-text-hex" class="shc-hex" value="#ffffff" maxlength="7" oninput="shcHex('text',this.value)">
                    </div>
                </div>
                <div class="shc-field">
                    <div class="shc-flabel">Dim Text</div>
                    <div class="shc-cpair">
                        <input type="color" id="shc-text-dim" value="#71717a" oninput="shcColor('text-dim',this.value)">
                        <input type="text"  id="shc-text-dim-hex" class="shc-hex" value="#71717a" maxlength="7" oninput="shcHex('text-dim',this.value)">
                    </div>
                </div>
            </div>

            <div class="shc-presets">
                <div class="shc-dot" style="background:#d2d2d2" onclick="shcAccentPreset('#d2d2d2','#08080a')" title="Silver"></div>
                <div class="shc-dot" style="background:#c8ff00" onclick="shcAccentPreset('#c8ff00','#000')" title="Neon"></div>
                <div class="shc-dot" style="background:#ff3cac" onclick="shcAccentPreset('#ff3cac','#fff')" title="Pink"></div>
                <div class="shc-dot" style="background:#00f5d4" onclick="shcAccentPreset('#00f5d4','#000')" title="Mint"></div>
                <div class="shc-dot" style="background:#ff6b35" onclick="shcAccentPreset('#ff6b35','#000')" title="Fire"></div>
                <div class="shc-dot" style="background:#a78bfa" onclick="shcAccentPreset('#a78bfa','#fff')" title="Lavender"></div>
                <div class="shc-dot" style="background:#60a5fa" onclick="shcAccentPreset('#60a5fa','#000')" title="Sky"></div>
                <div class="shc-dot" style="background:#f59e0b" onclick="shcAccentPreset('#f59e0b','#000')" title="Amber"></div>
            </div>

            <div class="shc-section">FONT</div>
            <div class="shc-chips" id="shc-font-chips">
                <div class="shc-chip active" data-font="'Inter',system-ui,sans-serif" onclick="shcFont(this)" style="font-family:system-ui">Inter</div>
                <div class="shc-chip" data-font="Georgia,serif" onclick="shcFont(this)" style="font-family:Georgia,serif">Serif</div>
                <div class="shc-chip" data-font="'Courier New',monospace" onclick="shcFont(this)" style="font-family:monospace">Mono</div>
                <div class="shc-chip" data-font="cursive" onclick="shcFont(this)" style="font-family:cursive">Script</div>
            </div>

            <div class="shc-section">TOPBAR</div>
            <div class="shc-row">
                <span class="shc-rlabel">Height</span>
                <input type="range" id="shc-topbar-h" min="60" max="140" value="100" oninput="shcSlider('topbar-h',this.value,'px')">
                <span class="shc-rval" id="shc-topbar-h-val">100px</span>
            </div>

            <div class="shc-section">SEARCH BAR</div>
            <div class="shc-row">
                <span class="shc-rlabel">Width</span>
                <input type="range" id="shc-search-w" min="200" max="700" value="380" oninput="shcSlider('search-w',this.value,'px')">
                <span class="shc-rval" id="shc-search-w-val">380px</span>
            </div>
            <div class="shc-row">
                <span class="shc-rlabel">Radius</span>
                <input type="range" id="shc-search-radius" min="0" max="40" value="12" oninput="shcSlider('search-radius',this.value,'px')">
                <span class="shc-rval" id="shc-search-radius-val">12px</span>
            </div>
            <div class="shc-row">
                <span class="shc-rlabel">Btn Radius</span>
                <input type="range" id="shc-search-btn-r" min="0" max="40" value="8" oninput="shcSlider('search-btn-r',this.value,'px')">
                <span class="shc-rval" id="shc-search-btn-r-val">8px</span>
            </div>
            <div class="shc-sublabel">Search Position</div>
            <div class="shc-chips" id="shc-pos-chips">
                <div class="shc-chip active" data-pos="center" onclick="shcSearchPos(this)">Center</div>
                <div class="shc-chip" data-pos="left" onclick="shcSearchPos(this)">Left</div>
                <div class="shc-chip" data-pos="right" onclick="shcSearchPos(this)">Right</div>
            </div>

            <div class="shc-section">SIDEBAR</div>
            <div class="shc-row">
                <span class="shc-rlabel">Width</span>
                <input type="range" id="shc-sidebar-w" min="70" max="200" value="120" oninput="shcSlider('sidebar-w',this.value,'px')">
                <span class="shc-rval" id="shc-sidebar-w-val">120px</span>
            </div>
            <div class="shc-row">
                <span class="shc-rlabel">Icon Size</span>
                <input type="range" id="shc-icon-size" min="40" max="90" value="74" oninput="shcSlider('icon-size',this.value,'px')">
                <span class="shc-rval" id="shc-icon-size-val">74px</span>
            </div>
            <div class="shc-row">
                <span class="shc-rlabel">Icon Radius</span>
                <input type="range" id="shc-icon-radius" min="0" max="50" value="18" oninput="shcSlider('icon-radius',this.value,'px')">
                <span class="shc-rval" id="shc-icon-radius-val">18px</span>
            </div>

            <div class="shc-section">LOGO</div>
            <div class="shc-row">
                <span class="shc-rlabel">Size</span>
                <input type="range" id="shc-logo-size" min="40" max="100" value="74" oninput="shcSlider('logo-size',this.value,'px')">
                <span class="shc-rval" id="shc-logo-size-val">74px</span>
            </div>
            <div class="shc-row">
                <span class="shc-rlabel">Radius</span>
                <input type="range" id="shc-logo-radius" min="0" max="50" value="20" oninput="shcSlider('logo-radius',this.value,'px')">
                <span class="shc-rval" id="shc-logo-radius-val">20px</span>
            </div>

            <div class="shc-section">AVATAR SHAPE</div>
            <div class="shc-chips" id="shc-av-chips">
                <div class="shc-chip active" data-av="15" onclick="shcAvatar(this)">Rounded</div>
                <div class="shc-chip" data-av="50" onclick="shcAvatar(this)">Circle</div>
                <div class="shc-chip" data-av="4" onclick="shcAvatar(this)">Sharp</div>
                <div class="shc-chip" data-av="0" onclick="shcAvatar(this)">Square</div>
            </div>

            <div class="shc-section">QUICK PRESETS</div>
            <div class="shc-pbtns">
                <button class="shc-pbtn" onclick="shcPreset('minimal')">Minimal</button>
                <button class="shc-pbtn" onclick="shcPreset('rounded')">Rounded</button>
                <button class="shc-pbtn" onclick="shcPreset('compact')">Compact</button>
                <button class="shc-pbtn" onclick="shcPreset('wide')">Wide</button>
            </div>
        </div>

        <div class="shc-footer">
            <button class="shc-btn-ghost" onclick="shcReset()">‚Ü∫ Reset</button>
            <button class="shc-btn-accent" onclick="shcSave()">üíæ Save</button>
        </div>
    </div>

    <!-- FRIEND LIST PANEL -->
    <div id="friend-panel" class="friend-panel hidden">

        <!-- VIEW: FRIENDS -->
        <div class="fp-view" id="fp-view-friends">
            <div class="friend-panel-header">
                <div class="friend-panel-title" onclick="fpOpenProfile()" style="cursor:pointer;" title="View your profile">
                    <div class="fp-av" id="fp-av">?</div>
                    <div>
                        <div class="fp-username" id="fp-username">...</div>
                        <div class="fp-status">‚óè Online</div>
                    </div>
                </div>
                <button class="friend-panel-close" onclick="closeFriendPanel()">‚úï</button>
            </div>

            <div class="friend-panel-tabs">
                <button class="fp-tab active" id="fp-tab-friends" onclick="fpSetTab('friends',this)">Friends <span class="fp-count" id="fp-friends-count">0</span></button>
                <button class="fp-tab" id="fp-tab-requests" onclick="fpSetTab('requests',this)">Requests <span class="fp-count fp-count-alert" id="fp-req-count">0</span></button>
            </div>

            <div class="friend-search-row">
                <input class="friend-search" id="friend-search" type="text" placeholder="Search friends‚Ä¶" oninput="fpSearch(this.value)">
            </div>

            <div class="fp-scroll-area">
                <div class="fp-list" id="fp-friends-list"></div>
                <div class="fp-list" id="fp-requests-list" style="display:none;"></div>
            </div>

            <div class="fp-add-row">
                <input class="friend-search" id="fp-add-input" type="text" placeholder="Add by username‚Ä¶" style="flex:1;">
                <button class="fp-add-btn" onclick="fpSendRequest()">Add</button>
            </div>
        </div>

        <!-- VIEW: PROFILE -->
        <div class="fp-view" id="fp-view-profile" style="display:none;flex-direction:column;height:100%;">
            <div class="fpp-topbar">
                <button class="fp-back-btn" onclick="fpCloseProfile()">‚Üê Back</button>
                <span class="fpp-topbar-title">My Profile</span>
                <div style="display:flex;gap:6px;align-items:center;">
                    <button class="fpp-customize-btn" id="fpp-customize-toggle" onclick="fppToggleCustomizer()" title="Customize Profile">üé®</button>
                    <button class="fpp-customize-btn" id="fpp-css-tab-btn" onclick="fppToggleCssEditor()" title="CSS Editor">‚ú¶ CSS</button>
                    <button class="fpp-fullscreen-btn" id="fpp-fs-btn" onclick="fppToggleFullscreen()" title="Fullscreen Profile">‚õ∂</button>
                    <button class="friend-panel-close" onclick="closeFriendPanel()">‚úï</button>
                </div>
            </div>

            <div class="fpp-banner" id="fpp-banner">
                <div class="fpp-banner-img-overlay" id="fpp-banner-img-overlay"></div>
                <div class="fpp-banner-av-wrap">
                    <div class="fpp-banner-av" id="fpp-banner-av">?</div>
                    <label class="fpp-av-upload-btn" title="Change avatar">
                        üì∑
                        <input type="file" accept="image/*" style="display:none" onchange="fppUploadAvatar(event)">
                    </label>
                </div>
            </div>

            <div class="fpp-info">
                <div class="fpp-name" id="fpp-display-name" contenteditable="true" title="Click to edit name">...</div>
                <div class="fpp-handle" id="fpp-handle">@... ¬∑ <span style="color:#4ade80">‚óè Online</span></div>
                <div class="fpp-bio" id="fpp-bio" contenteditable="true" title="Click to edit bio">...</div>
                <div class="fpp-stats">
                    <div class="fpp-stat"><span class="fpp-stat-n" id="fpp-posts-count">0</span><span class="fpp-stat-l">Posts</span></div>
                    <div class="fpp-stat"><span class="fpp-stat-n" id="fpp-friends-stat">0</span><span class="fpp-stat-l">Friends</span></div>
                    <div class="fpp-stat"><span class="fpp-stat-n">8</span><span class="fpp-stat-l">Servers</span></div>
                </div>
            </div>

            <!-- PROFILE CUSTOMIZER PANEL -->
            <div class="fpp-customizer" id="fpp-customizer" style="display:none;">
                <div class="fpp-cust-section">ACCENT COLOR</div>
                <div class="fpp-swatches" id="fpp-swatches">
                    <div class="fpp-swatch active" data-color="#c8ff00" data-text="#000" style="background:#c8ff00" onclick="fppSetColor(this)"></div>
                    <div class="fpp-swatch" data-color="#a78bfa" data-text="#fff" style="background:#a78bfa" onclick="fppSetColor(this)"></div>
                    <div class="fpp-swatch" data-color="#ff3cac" data-text="#fff" style="background:#ff3cac" onclick="fppSetColor(this)"></div>
                    <div class="fpp-swatch" data-color="#00f5d4" data-text="#000" style="background:#00f5d4" onclick="fppSetColor(this)"></div>
                    <div class="fpp-swatch" data-color="#ff6b35" data-text="#fff" style="background:#ff6b35" onclick="fppSetColor(this)"></div>
                    <div class="fpp-swatch" data-color="#60a5fa" data-text="#fff" style="background:#60a5fa" onclick="fppSetColor(this)"></div>
                    <div class="fpp-swatch" data-color="#f9a8d4" data-text="#000" style="background:#f9a8d4" onclick="fppSetColor(this)"></div>
                    <div class="fpp-swatch" data-color="#d2d2d2" data-text="#000" style="background:#d2d2d2" onclick="fppSetColor(this)"></div>
                    <input type="color" class="fpp-color-custom" value="#c8ff00" oninput="fppSetColorCustom(this.value)">
                </div>

                <div class="fpp-cust-section">BANNER STYLE</div>
                <div class="fpp-banner-opts">
                    <div class="fpp-bopt active" data-bg="solid" onclick="fppSetBanner(this)">Solid</div>
                    <div class="fpp-bopt" data-bg="gradient" onclick="fppSetBanner(this)">Gradient</div>
                    <div class="fpp-bopt" data-bg="grid" onclick="fppSetBanner(this)">Grid</div>
                    <div class="fpp-bopt" data-bg="dots" onclick="fppSetBanner(this)">Dots</div>
                    <div class="fpp-bopt" data-bg="image" onclick="fppSetBanner(this)">Image</div>
                </div>

                <div class="fpp-cust-row" id="fpp-banner-img-row" style="display:none;">
                    <label class="fpp-upload-label">
                        üìÅ Upload Banner Image
                        <input type="file" accept="image/*" style="display:none" onchange="fppUploadBanner(event)">
                    </label>
                    <button class="fpp-small-btn" onclick="fppClearBanner()">Clear</button>
                </div>

                <div class="fpp-cust-section">PROFILE BACKGROUND</div>
                <div class="fpp-banner-opts" id="fpp-bg-opts">
                    <div class="fpp-bopt active" data-pbg="dark" onclick="fppSetProfileBg(this)">Dark</div>
                    <div class="fpp-bopt" data-pbg="darker" onclick="fppSetProfileBg(this)">Darker</div>
                    <div class="fpp-bopt" data-pbg="light" onclick="fppSetProfileBg(this)">Light</div>
                    <div class="fpp-bopt" data-pbg="accent" onclick="fppSetProfileBg(this)">Accent</div>
                    <div class="fpp-bopt" data-pbg="image" onclick="fppSetProfileBg(this)">Image</div>
                </div>
                <div class="fpp-cust-row" id="fpp-bg-img-row" style="display:none;">
                    <label class="fpp-upload-label">
                        üìÅ Upload Background
                        <input type="file" accept="image/*" style="display:none" onchange="fppUploadProfileBg(event)">
                    </label>
                    <button class="fpp-small-btn" onclick="fppClearProfileBg()">Clear</button>
                </div>

                <div class="fpp-cust-section">FONT SIZE</div>
                <div class="fpp-cust-row">
                    <input type="range" id="fpp-font-size" min="12" max="20" value="14" oninput="fppSetFontSize(this.value)" style="flex:1;">
                    <span class="fpp-range-val" id="fpp-font-size-val">14px</span>
                </div>

                <div class="fpp-cust-section">FONT STYLE</div>
                <div class="fpp-banner-opts" id="fpp-font-opts">
                    <div class="fpp-bopt active" data-ff="inter" onclick="fppSetFont(this)">Inter</div>
                    <div class="fpp-bopt" data-ff="serif" onclick="fppSetFont(this)">Serif</div>
                    <div class="fpp-bopt" data-ff="mono" onclick="fppSetFont(this)">Mono</div>
                    <div class="fpp-bopt" data-ff="script" onclick="fppSetFont(this)">Script</div>
                </div>
            </div>

            <!-- CSS EDITOR PANEL -->
            <div id="fpp-css-editor-wrap" class="fpp-css-editor-wrap" style="display:none;">
                <div class="fpp-css-topbar">
                    <span class="fpp-css-label">‚ú¶ CSS <span style="opacity:0.4;font-weight:400;">¬∑ applies to your profile</span></span>
                    <div style="display:flex;gap:6px;">
                        <button class="fpp-css-btn fpp-css-reset" onclick="fppResetCss()">‚Ü∫ Reset</button>
                        <button class="fpp-css-btn fpp-css-apply" onclick="fppApplyCss()">‚ñ≤ Apply</button>
                    </div>
                </div>
                <textarea id="fpp-css-textarea" class="fpp-css-textarea" spellcheck="false" placeholder="/* Write CSS here... */"></textarea>
                <div class="fpp-css-hints">
                    <span>.fpp-name</span>
                    <span>.fpp-bio</span>
                    <span>.fpp-banner</span>
                    <span>.fpp-post</span>
                    <span>.fpp-feed</span>
                    <span>.fpp-stats</span>
                    <span>.fpp-composer</span>
                </div>
            </div>
            <div id="fpp-css-toast" class="fpp-css-toast">‚úì CSS Applied</div>

            <!-- Post composer -->
            <div class="fpp-composer">
                <div class="fpp-compose-media-preview" id="fpp-compose-preview" style="display:none;"></div>
                <textarea id="fpp-compose-input" class="fpp-compose-input" placeholder="Share something‚Ä¶" rows="2"></textarea>
                <div class="fpp-compose-toolbar">
                    <div class="fpp-compose-tools">
                        <label class="fpp-tool-btn" title="Photo">
                            üñº
                            <input type="file" accept="image/*" style="display:none" onchange="fppAttachMedia(event,'image')">
                        </label>
                        <label class="fpp-tool-btn" title="Video">
                            üé¨
                            <input type="file" accept="video/*" style="display:none" onchange="fppAttachMedia(event,'video')">
                        </label>
                        <label class="fpp-tool-btn" title="Audio">
                            üéµ
                            <input type="file" accept="audio/*" style="display:none" onchange="fppAttachMedia(event,'audio')">
                        </label>
                        <label class="fpp-tool-btn" title="File">
                            üìé
                            <input type="file" style="display:none" onchange="fppAttachMedia(event,'file')">
                        </label>
                    </div>
                    <button class="fpp-post-btn" onclick="fppPost()">Post</button>
                </div>
            </div>

            <!-- Profile posts feed -->
            <div class="fpp-feed" id="fpp-feed"></div>
        </div>

    </div>
    <div id="friend-panel-backdrop" class="friend-panel-backdrop hidden"></div>

    <!-- PROFILE FULLSCREEN OVERLAY -->
    <div id="fpp-fullscreen-overlay" class="fpp-fullscreen-overlay hidden" onclick="fppToggleFullscreen()"></div>

    <!-- AUTH MODAL -->
    <div id="auth-overlay" class="auth-overlay hidden">
      <div class="auth-box">
        <div class="auth-logo">‚ß° Branch</div>
        <div class="auth-tabs">
          <button class="auth-tab active" onclick="switchAuthTab('login', event)">Login</button>
          <button class="auth-tab" onclick="switchAuthTab('register', event)">Register</button>
        </div>
        <div id="auth-login" class="auth-form">
          <input id="login-username" class="auth-input" type="text" placeholder="Username">
          <input id="login-password" class="auth-input" type="password" placeholder="Password">
          <div id="login-error" class="auth-error"></div>
          <button class="auth-btn" onclick="doLogin()">Login</button>
        </div>
        <div id="auth-register" class="auth-form" style="display:none;">
          <input id="reg-username" class="auth-input" type="text" placeholder="Username">
          <input id="reg-displayname" class="auth-input" type="text" placeholder="Display name (optional)">
          <input id="reg-password" class="auth-input" type="password" placeholder="Password">
          <input id="reg-password2" class="auth-input" type="password" placeholder="Confirm password">
          <div id="reg-error" class="auth-error"></div>
          <button class="auth-btn" onclick="doRegister()">Create Account</button>
        </div>
      </div>
    </div>

    <script src="branch.js"></script>
    <script src="branch-servers.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs/loader.min.js"></script>
    <script src="branch-editor.js"></script>
</body>
</html>
